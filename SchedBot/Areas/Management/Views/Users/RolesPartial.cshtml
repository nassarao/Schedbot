@model IEnumerable<SchedbotDTOs.JobRole>

<div class="col-md-12 col-sm-12">
    <div class="portlet light">
        <div class="portlet-title">
            <div class="caption font-schedBot">Employee Roles</div>
        </div>
        <div class="portlet-body">
            <form class="form-horizontal">
                <div class="form-body">
                    <div class="form-group">
                        <div class="col-md-12 margin-bottom-15">
                            <label class="col-md-9">Roles:</label>
                            <div class="col-md-3"><button class="btn btn-xs btn-outline blue-steel" type="button" id="updateRoles" name="updateRoles"><i class="fa fa-plus"></i> Update Roles</button></div>
                        </div>
                        <div class="col-md-12">
                            <div id='updateRoles' class='modal fade in' data-toggle="modal" data-target="#updateRolesModal">
                            </div>
                            <div class="table table-responsive table-striped table-hover col-md-12">
                                <table class="col-md-12 table-responsive table-striped table-hover" >
                                    <tbody name="rolesTable" id="rolesTable">
                                      @foreach (var item in Model)
                                      {
                                          <tr>@item.Name</tr><br />
                                      }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                 
                </div>

             
            </form>
        </div>
    </div>
</div>


<script>
    $(document).ready(function () {

        $('#updateRoles').click(function () {
            console.log("table roles grab", $('#rolesTable').text());
            console.info("made inside new request click");
            $('#updateRolesModal').modal('show');

        });
        
        
        
        
        
        function getRoles(userId){
            $.ajax({
            url: '@Url.Action("Edit", "Users")'
            , type: "get"
            , data: userId
            , success: function (response) {
                
                //swal('Success!', "Successfully got roles data", 'success');
//                var htmlResponse = $.parseHTML(response);
//                console.warn(response);
//                var rolesTable = $(response).find('#rolesTable').detach();
//                var rt2 = $(response).remove('#rolesTable');
                var indexStart = response.indexOf('<tbody name="rolesTable" id="rolesTable">');
                var tbodyStartLength = '<tbody name="rolesTable" id="rolesTable">'.length;
                var indexEnd = response.indexOf('</tbody>');
                var trs = response.slice(indexStart + tbodyStartLength, indexEnd);
//                console.log("table roles grab", $('#rolesTable').html())
//                $('#rolesTable').html(trs);
//                console.log("role tables html: ", rolesTable.html());
//                console.log("indexs: ", indexStart, indexEnd);
                trs = trs.replace(/<tr>/gi, "");
                trs = trs.replace(/<\/tr>/gi, "");
                var realRows = $('div.table').html();
                var rrTable = realRows.indexOf('<table');
                realRows = realRows.slice(rrTable);
//                console.info(trs);
//                console.info("RR",realRows);
                $('div.table').html(trs + realRows);

                                
            }
            , error: function (response) {
                sweetAlert("Oops...", "Something went wrong getting roles data!", "error");
            }
        });
        }
        
        
        $('#updateRolesSubmit').click(function () {
        
        var model_to_update = $('#rolesModalForm');
            var userId = $('#user_UserId').val();

        console.info("Inside availability click...", userId);
        
        
        $.ajax({
            url: '@Url.Action("SaveRoles", "Users")'
            , type: "POST"
            , data: model_to_update.serialize()
            , success: function (response) {
                $('#updateRolesModal').modal('toggle');
                
                getRoles(userId);
                swal('Success!', 'User roles successfully updated', 'success');
                                
            }
            , error: function (response) {
                sweetAlert("Oops...", "Something went wrong!", "error");
            }
        });
    });

    });
</script>