@model SchedBot.Models.RequestViewModel

@{
    ViewBag.Title = "Requests";
    ViewBag.Current = "Requests";
}


<link href="~/Content/daterangepicker.min.css" rel="stylesheet" type="text/css" />

<div>
    <div class="col-md-12 col-sm-12 margin-bottom-20">
        <button class="btn green-meadow btn-outline sbold" id="newRequest"><i class="fa fa-plus"></i>&nbsp; New Request</button>
    </div>
    <div class="col-md-12">
        <div id="newRequest" class="modal fade in" data-toggle="modal" data-target="#requestNewModal">
        </div>
        <div class="portlet light portlet-fit">
            <div class="portlet-title">
                <div class="caption font-schedBot">
                    <span>Requests</span>
                </div>
            </div>
            <div class="portlet-body table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th class="col-md-2">Type</th>
                            <th class="col-md-5">Employee(s)</th>
                            <th class="col-md-2">Status</th>
                            <th class="col-md-1 text-center">Approve</th>
                            <th class="col-md-1 text-center">Deny</th>
                            <th class="col-md-1 text-center">Details</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var req in Model.Requests)
                        {
                            <tr>
                                <td class="col-md-2">@req.requestDTO.RequestType </td>
                                <td>@req.sending.FirstName @req.sending.LastName</td>
                                <td>@req.requestDTO.Status</td>
                              
                                    <td class="col-md-1 text-center"><a href="#" id="requestApprove" class="font-dark approveRequest"><i class="fa fa-2x fa-check"></i></a></td>
                                    <td class="col-md-1 text-center"><a href="#" id="requestDeny" class="font-dark denyRequest"><i class="fa fa-2x fa-times"></i></a></td>
                                    @if (req.requestDTO.RequestType == "Time Off")
                                    {
                                        <td class="col-md-1 text-center"><a href="#" id="viewTimeOffDetails" class="font-dark viewTimeOffDetails" data-toggle="modal" data-target="#timeOffDetailsModal" data-firstName="@req.sending.FirstName" data-lastName="@req.sending.LastName" data-startTimeOff="@req.requestDTO.StartTimeOff" data-endTimeOff="@req.requestDTO.EndTimeOff" data-requestReason="@req.requestDTO.Reason" data-requestStatus="@req.requestDTO.Status"><i class="fa fa-2x fa-commenting-o"></i></a></td>
                                    }
                                    @if (req.RequestType == "Trade")
                                    {
                                        <td class="col-md-1 text-center"><a href="#" id="viewTradeDetails" class="font-dark viewTradeDetails" data-toggle="modal" data-target="#tradeDetailsModal" data-senderFirstName="@req.SendingUser.FirstName" data-senderLastName="@req.SendingUser.LastName" data-senderShiftDay="@req.StartTimeOff" data-senderShiftStart="@req.OriginalShiftId" data-senderShiftEnd="@req.OriginalShiftId" data-receiveFirstName="@req.EndTimeOff" data-receiveLastName="@req.OriginalShiftId" data-receiveShiftDay="@req.OriginalShiftId" data-receiveShiftStart="@req.OriginalShiftId" data-receiveShiftEnd="@req.OriginalShiftId" data-requestReason="@req.Reason" data-requestStatus="@req.Status"><i class="fa fa-2x fa-commenting-o"></i></a></td>

                                    }


                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
        <div id='requestDetails' class='modal fade in' data-toggle="modal" data-target="#requestDetailsModal">
        </div>
        <div id='requestDeny' class='modal fade in' data-toggle="modal" data-target="#requestDenyModal">
        </div>
        <div id='requestApprove' class='modal fade in' data-toggle="modal" data-target="#requestApproveModal">
        </div>
    </div>




    @Html.Partial("timeOffDetailsModalPartial")
    @Html.Partial("tradeDetailsModalPartial")

    <!-- ************************************* Deny Modal ***************************************** -->
    @Html.Partial("DenyModalPartial")

    <!-- ************************************* Request Deny End ***************************************** -->
    <!-- ************************************* Approve Modal ***************************************** -->
    @Html.Partial("ApproveModalPartial")

    <!-- ************************************* Request Approve End ***************************************** -->
    <!-- ************************************* New Request Modal ***************************************** -->
    @Html.Partial("NewRequestModal", Model)

</div>


@*@Scripts.Render("~/bundles/jquery")*@

<script src="~/Scripts/jquery-1.10.2.js" type="text/javascript"></script>
<script src="~/Scripts/moment.min.js" type="text/javascript"></script>
<script src="~/Scripts/daterangepicker2.js" type="text/javascript"></script>
<script>


    $('input[name="daterange"]').daterangepicker();
    $('button[name="daterange"]').click(function () {
        $('input[name="daterange"]').trigger("click");
    });

    $(document).ready(function () {


        $(".viewTimeOffDetails").click(function () {
            var firstName = $(this).data("firstname");
            var lastName = $(this).data("lastname");
            var startTime = $(this).data('starttimeoff');
            var endTime = $(this).data('endtimeoff');
            var status = $(this).data('requeststatus');
            var reason = $(this).data('requestreason');

            console.log(startTime, endTime, status, reason);
            $('#employeeName').html(firstName + " " + lastName);
            $('#requestTimeSpan').html(startTime + " - " + endTime);
            $('#requestStatus').html(status);
            $('#requestReason').html(reason);

        });



        $(".viewTradeDetails").click(function () {
            var senderFirstName = $(this).data("senderfirstname");
            var senderLastName = $(this).data("senderlastname");
            var receiverFirstName = $(this).data("receivefirstname");
            var receiverLastName = $(this).data("receivelastname");
            var senderShiftDay = $(this).data('sendershiftday');
            var senderShiftStart = $(this).data('sendershiftstart');
            var senderShiftEnd = $(this).data('sendershiftend');
            var receiverShiftStart = $(this).data('receiveshiftstart');
            var receiverShiftEnd = $(this).data('receiveshiftend');
            var receiverShiftDay = $(this).data('receiveshiftday');
            var status = $(this).data('requeststatus');
            var reason = $(this).data('requestreason');

            //console.log(startTime, endTime, status, reason);
            //$('#employeeName').html(firstName + " " + lastName);
            //$('#requestTimeSpan').html(startTime + " - " + endTime);
            //$('#requestStatus').html(status);
            //$('#requestReason').html(reason);

        });





        $('#newRequest').click(function () {

            console.info("made inside new request click");
            $('#requestNewModal').modal('show');

        });

        $('#requestApprove').click(function () {

            console.info("made inside new request click");
            $('#requestApproveModal').modal('show');

        });

        $('#requestDeny').click(function () {

            console.info("made inside new request click");
            $('#requestDenyModal').modal('show');

        });

        $('#requestDetails').click(function () {

            console.info("made inside new request click");
            $('#requestDetailsModal').modal('show');

        });




        $("#timeOffRange").hide();



        $(document).on("change", "#newRequestType", function () {

            var requestType = $("#newRequestType").val();
            var dynamicHTML = {};
            var url = $("#changingHtml").data("request-url");
            if (requestType == "trade") {
                //               dynamicHTML = '   <div>  ' +
                //'                               <div class="form-group">  ' +
                //'                                   <div class="col-md-4">  ' +
                //'                                       <label class="control-label">Current Shift:</label>  ' +
                //'                                   </div>  ' +
                //'                                   <div class="col-md-8 no-padding">  ' +
                //'                                       <div class="col-md-12 no-padding">  ' +
                //'                                           <select class="form-control" id="newRequestCurrentShift">  ' +
                //'                                               <option value selected disabled></option>  ' +
                //'                                               <option value="Mon">Mon</option>  ' +
                //'                                               <option value="Tues">Tues</option>  ' +
                //'                                           </select>  ' +
                //'                                       </div>  ' +
                //'     ' +
                //'                                   </div>  ' +
                //'                               </div>  ' +
                //'                           </div>  ' +
                //'     ' +
                //'                           <div>  ' +
                //'                               <div class="form-group">  ' +
                //'                                   <div class="col-md-4">  ' +
                //'                                       <label class="control-label">Employee to Trade:</label>  ' +
                //'                                   </div>  ' +
                //'                                   <div class="col-md-8 no-padding">  ' +
                //'                                       <div class="col-md-12 no-padding">  ' +
                //'                                           <select class="form-control" id="newRequestEmployeeToTrade">  ' +
                //'                                               <option value selected disabled></option>  ' +
                //'                                               <option value="Ahmad">Ahmad</option>  ' +
                //'                                               <option value="Adam">Adam</option>  ' +
                //'                                           </select>  ' +
                //'                                       </div>  ' +
                //'     ' +
                //'                                   </div>  ' +
                //'                               </div>  ' +
                //'                           </div>  ' +
                //'                           <div>  ' +
                //'                               <div class="form-group">  ' +
                //'                                   <div class="col-md-4">  ' +
                //'                                       <label class="control-label">Shift To Trade For:</label>  ' +
                //'                                   </div>  ' +
                //'                                   <div class="col-md-8 no-padding">  ' +
                //'                                       <div class="col-md-12 no-padding">  ' +
                //'                                           <select class="form-control" id="newRequestTradeForShift">  ' +
                //'                                               <option value selected disabled></option>  ' +
                //'                                               <option value="Mon">Mon (Shift Hours)</option>  ' +
                //'                                               <option value="Tues">Tues (Shift Hours)</option>  ' +
                //'                                           </select>  ' +
                //'                                       </div>  ' +
                //'     ' +
                //'                                   </div>  ' +
                //'                               </div>  ' +
                //'                          </div>  ';
                //               $("#newRequestHTML").html(dynamicHTML);
                $("#changingHtml").load(url);
                $("#timeOffRange").hide();
            }
            else if (requestType == "timeOff") {
                dynamicHTML = '';
                $("#newRequestHTML").html(dynamicHTML);
                $("#timeOffRange").show();
            }
            else if (requestType != "timeOff") {
                $("#timeOffRange").hide();
            }

        });

        $(document).on("change", "#Users", function () {
            var selectedUserValue = $("#Users").val();
            console.log(selectedUserValue);
            var url = $("#TradableShifts").data("request-url");
            console.log(url);
            $("#TradableShifts").load(url, { userId: selectedUserValue });
        });


    });
</script>
